## 相关网站资源

python官网：https://www.python.org/

python官网文档：[Python 教程 — Python 3.10.4 文档](https://docs.python.org/zh-cn/3/tutorial/index.html)



Python学习论坛： [Python中文网-Python爱好者学习网站](https://www.python-china.com/)



## window安装python

### window版本exe安装

```
1. https://www.python.org/ftp/python/3.10.4/python-3.10.4-amd64.exe  下载安装包
2，安装即可
```





### window版本zip便携版安装

> 不是所有版本的python官网都提供了zip文件，下面以3.8.5为例

1. 下载python

   ```
   1) 官网https://www.python.org/downloads/release/python-385/找到"Windows x86-64 embeddable zip file"版本
   	下载zip压缩包：https://www.python.org/ftp/python/3.8.5/python-3.8.5-embed-amd64.zip
   	
   2) 添加path路径到环境变量中
   ```

2. 安装pip

   ```
   1. 网页https://pypi.org/project/pip/，点击【Project description/Installation】
   
   2. 跳转到[Supported Methods/get-pip.py]目录下，有下载连链接
   	1) curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py
   	2) python get-pip.py	执行完成python根目录会自动创建Lib和Scripts文件夹
   
   3. python根目录找到python38._pth文件，使用记事本打开，去掉 “import site”前面的 # 号
   ```

3. 测试

   ```
   python -V      查看python版本号
   
   pip -V            查看pip管理工具的版本号
   ```

   



## linux安装python



**卸载原python环境**

```
rpm -qa|grep python|xargs rpm -ev --allmatches --nodeps
whereis python |xargs rm -frv
whereis python
```



### 源码安装

1. https://www.python.org/ftp/python/3.10.4/Python-3.10.4.tgz下载安装包

2. 安装环境准备

   ```
   #首先需要gcc环境和zlib库，为了方向键等不出现乱码还需要 readline-devel 包
   
   yum -y install gcc make openssl-devel sqlite-devel		#django时会用到sqlite-devel
   	#openssl-devel好像没什么用，yum安装的版本比较低，需要在后面使用源码安装
   yum -y install zlib*
   yum install readline-devel
   ```

   

   另：下面的可选安装包供参考

   ```
   yum install gcc patch libffi-devel python-devel  zlib-devel bzip2-devel openssl-devel ncurses-devel sqlite-devel readline-devel tk-devel gdbm-devel db4-devel libpcap-devel xz-devel -y
   ```

   

3. 解压、配置、安装

   ```
   tar zxf Python-3.10.4.tgz && cd Python-3.10.4
   
   ./configure --prefix=/usr/local/Python-3.10.4  --with-openssl=/usr/bin/openssl（这个应该要指向文件夹吧）
   	#注意--with-openssl可能会因为openssl的版本较低会提示TLS/SSL不可用，解决方法见下面记录
   
   make -j 4 ; make install
   ```

   

4. 添加path路径或软连接

   > 如果不添加path路径，也可以使用ln -s /usr/local/python_3.10.4/bin/python3.10  /usr/bin/python3

   ```
   cat  /etc/profile.d/python310.sh
   export PATH=$PATH:/usr/local/Python-3.10.4/bin
   ```



**安装中遇见的问题汇总：**

**问题一：pip list 时提示openssl不可用**

> 参考文档：
>
> https://blog.csdn.net/lkgCSDN/article/details/84403329
>
> https://www.jianshu.com/p/8e476eef43f7



- 问题现象： 如果./configure的时候不指定--with-openssl，安装后使用pip会提示如下信息

  ```
  WARNING: pip is configured with locations that require TLS/SSL, however the ssl module in Python is not available.
  ```

- 源码安装openssl

  ```
  -  wget https://www.openssl.org/source/openssl-1.1.1n.tar.gz		#openssl-3.0.2.tar.gz包测试过有问题
  
  -  cd openssl-1.1.1n  &&./config --prefix=/usr/local/openssl-1.1.1n [no-zlib]  #执行时提示：You need Perl 5
  
  - 安装perl 5 (可以直接yum install perl更方便些)			#参考文档:https://www.cpan.org/src/
  	wget https://www.cpan.org/src/5.0/perl-5.34.1.tar.gz
  	tar -xzf perl-5.34.1.tar.gz  &&  cd perl-5.34.1
  	./Configure -des -Dprefix=$HOME/localperl		
  		#会在/root/localperl/下生成bin、lib、man三个文件夹
  		#不太清楚Dprefix这个文件夹能否修改，编译完成后可执行文件在/usr/bin/perl（应该是程序自动将可执行文件拷贝过去了）
  	make
  	make test			（这一步会执行很长时间，可以跳过）
  	make install
  
  - 继续安装openssl...
  	./config --prefix=/usr/local/openssl-1.1.1n  [no-zlib]
  	make && make install
  ```



- 使用源码再次安装python（指定使用新版本的openssl）

  ```
  ./configure --prefix=/usr/local/python_3.10_openssl_make/ --with-openssl=/usr/local/openssl-1.1.1n
  	#注意--with-openssl指定的是目录，而不是/usr/local/openssl-1.1.1n/bin/openssl的可执行文件（可执行文件是不行的）
  
  make -j 4 ; make install
  ```

- 测试

  ```
  cd /usr/local/python_3.10_openssl_make/bin
  
  ./pip3 list  已经没有提示信息了
  ```

  





**问题二：centos7下 python升级后yum异常**

- centos7自带的python版本是2.7，安装python3后，软连接`/usr/bin/python`指向的版本是python3，yum使用可能会有问题，需要修改下yum的配置：

  ```
  vi /usr/bin/yum
  vi /usr/libexec/urlgrabber-ext-down
  在第一行#!/usr/bin/python把修改为#!/usr/bin/python2.7
  ```

  

### 便携式安装

将源码编译后的文件夹拷贝后到其他主机上，应该就可以直接使用了





### yum安装

配置centos的yum源：https://developer.aliyun.com/mirror/

```
yum install python39
	#yum install python 会提示可选版本为：python2, python36, python38, python39
	#直接yum安装也不会有TLS/SSL的问题
```





## 创建虚拟环境

### venv创建

**window**

```
python3 -m venv /path/to/new/virtual/environment

${virtual_env}/scripts/activate.bat            #运行虚拟环境

#参考文档：https://docs.python.org/zh-cn/3/library/venv.html
```



**linux**

```
python3 -m venv /path/to/new/virtual/environment		#创建虚拟环境

source ${virtual_env}/bin/activate					#进入虚拟环境

deactivate											#退出虚拟环境（没有看到这个文件，但是可以使用）
```



### virtualenv创建

**window**

```
1. 将python3.8.6的的路径及根路径下的Scripts加入全局环境变量
2. pip install virtualenv （将会安装在python的scripts文件夹中，在linux版本中为python的bin目录）
3. virtualenv django_test_env
4. 进入/退出虚拟环境：
    django_test_env/activate.bat        #进入虚拟环境
    django_test_env/deactivate.bat        #退出虚拟环境
5. 安装django
    pip install django==2.2            （安装在虚拟环境的scripts目录中，linux版本中为python的bin目录下）
    django-admin startproject test (只要activate.bat后在虚拟环境任意目录都能找到django-admin命令)
    #踩过的坑：此时将虚拟环境的目录名django_test_env修改为django_test，之后activate.bat就找不到django-admin的文件路径了。影响：在任意目录下创建project就受到影响了。
```





## python3.8.6额外修改部分：

**window版本**

```
1. 将原python根目录下的python38.zip文件拷贝到虚拟环境的django_test/scripts下

2. 修改django_test_env\lib\site-packages\django\views\debug.py 的line 331
    with Path(CURRENT_DIR, 'templates', 'technical_500.html').open(encoding="utf-8") as fh:
                t = DEBUG_ENGINE.from_string(fh.read())

3. 修改django_test_env\lib\site-packages\django\db\backends\mysql\operations.py", line 146
    query = getattr(cursor, '_executed', None)
    #if query is not None:
    #    query = query.decode(errors='replace')
    return query

4, 安装PyMySQL
    - pip install PyMySQL
    - 修改mysite/__init__.py:
        import pymysql
        pymysql.install_as_MySQLdb()
```







